# Z80用 クロスアセンブラ XSM リファレンスマニュアル

## 特徴
- C言語やJavaScriptライクな文法
  - 関数の概念がある
  - if文がある
  - for/loop/whileのループ文がある
  - 変数に配列や構造体の概念がある、またこれらをサポートする内部関数がある
  - 簡易な例外処理が書ける(try～catch~finally)
  - など…


- 疑似的に実現可能な命令を大量に追加

  ``` LD BC,HL``` Z80にはこのような命令は存在しませんが、```LD B,H``` と ```LD C,L``` に置き換えれば実現できますので、
  これをXSMでは ```BC = HL``` とそのまま表記できます。このような命令が多数存在します。


- レジスタの暗黙的使用(unsafe文)

  上記の疑似命令の拡張版ですが、A / HLレジスタを経由すれば実現可能な命令は記述を省略できます。
  例えば```LD (BC),D``` という命令は存在しませんが、```LD A,D```と```LD (BC),A```とすることで実現できますので、
  これをXSMでは ```*BC = D``` と記述できます。
  サポートされている命令は[疑似命令](virtualcode.md)の命令表を参照してください。


- 乗算、除算、剰余算のZ80がサポートしていない命令を疑似的にサポート

  ``` hl *= a```のように記述すると、掛け算ルーチンを呼び出す処理が出力されます。


- 自動PUSH/POP機能(using文)

  PUSH/POPを自動で行いプログラムを簡潔、安全に記述できます。
  ```
  using(HL,BC) {
    ...
    if(...) return;
  }
  ...
  return;
  ```
  このような処理がある場合、以下のように置き換えます。
  ```
  PUSH HL;PUSH BC; 
  ...
  if(...) {
    POP BC;POP HL;return;
  }
  ...
  POP BC;POP HL;return;
  ```

- 投影型変数(shadow)

  アセンブリ言語の場合、DB / DW 文などでメモリ領域を確保してしまうと、その分ビルドファイルのサイズが肥大化します。
  メッセージやマップデータのように初期値があるものは仕方がないのですが、テンポラリ的に使う領域もビルドファイルに含まれるのは好ましくありません。
  XSMでは、これらをビルドファイルに含まれない投影型として定義できます。


- 中間ファイルは生成せずcomファイルを一発生成

  一長一短ですが makefile のようにリンク処理などがないので開発がとても楽になります。
  メインプログラムが makefile を兼ねています。
